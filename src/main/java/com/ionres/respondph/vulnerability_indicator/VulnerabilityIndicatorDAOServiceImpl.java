package com.ionres.respondph.vulnerability_indicator;

import com.ionres.respondph.database.DBConnection;

import javax.swing.*;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class VulnerabilityIndicatorDAOServiceImpl implements VulnerabilityIndicatorDAOService{
    private final DBConnection dbconnection;
    private Connection conn;

    public VulnerabilityIndicatorDAOServiceImpl(DBConnection connection){
        this.dbconnection = connection;
    }

    @Override
    public boolean saveVulnerabilityScores(VulnerabilityIndicatorScoreModel vm) {

        String sql =
                "INSERT INTO vulnerability_indicator_score (" +
                        "vulnerability_indicator_id, male_score, female_score, " +
                        "single_score, married_score, widowed_score, separated_score, " +
                        "solo_parent_status_not_solo_parent_score, solo_parent_status_sp_with_sn_score, solo_parent_status_sp_without_sn_score, " +
                        "disability_none_score, disability_physical_score, disability_visual_score, " +
                        "disability_hearing_score, disability_speech_score, disability_intellectual_score, " +
                        "disability_mental_or_psychosocial_score, disability_chronic_score, disability_multiple_score, " +
                        "health_healthy_score, health_temporarily_ill_score, health_chronically_ill_score, " +
                        "health_immunocompromisedl_score, health_terminally_ill_score, health_with_medical_score, " +
                        "clean_water_access_yes_score, clean_water_access_no_score, clean_water_access_irregular_score, " +
                        "sanitation_safely_score, sanitation_shared_score, sanitation_unimproved_score, sanitation_no_score, " +
                        "house_construction_concrete_score, house_construction_light_materials_score, " +
                        "house_construction_semi_concrete_score, house_construction_makeshirt_score, " +
                        "ownership_owned_score, ownership_owned_without_score, ownership_rented_score, " +
                        "ownership_informal_score, ownership_evicted_score, " +
                        "employment_regular_score, employment_self_employed_stable_score, " +
                        "employment_self_employed_unstable_score, employment_irregular_score, employment_unemployed_score, " +
                        "income_poor_score, income_low_income_score, income_middle_income_score, income_middle_class_score, " +
                        "income_upper_middle_class_score, income_upper_income_score, income_rich_score, " +
                        "education_no_formal_education_score, education_elementary_score, education_highschool_score, " +
                        "education_vocational_score, education_college_score, education_graduated_score, " +
                        "digital_reliable_score, digital_intermittent_score, digital_limited_access_score, digital_no_digital_score, " +
                        "damage_no_visible_damage, damage_minor_damage, damage_moderate_damage, damage_severe_damage, damage_destruction_or_collapse, " +
                        "reg_date) VALUES (" +
                        "?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?) " +
                        "ON DUPLICATE KEY UPDATE " +
                        "male_score=VALUES(male_score), " +
                        "female_score=VALUES(female_score), " +
                        "single_score=VALUES(single_score), " +
                        "married_score=VALUES(married_score), " +
                        "widowed_score=VALUES(widowed_score), " +
                        "separated_score=VALUES(separated_score), " +
                        "solo_parent_status_not_solo_parent_score=VALUES(solo_parent_status_not_solo_parent_score), " +
                        "solo_parent_status_sp_with_sn_score=VALUES(solo_parent_status_sp_with_sn_score), " +
                        "solo_parent_status_sp_without_sn_score=VALUES(solo_parent_status_sp_without_sn_score), " +
                        "disability_none_score=VALUES(disability_none_score), " +
                        "disability_physical_score=VALUES(disability_physical_score), " +
                        "disability_visual_score=VALUES(disability_visual_score), " +
                        "disability_hearing_score=VALUES(disability_hearing_score), " +
                        "disability_speech_score=VALUES(disability_speech_score), " +
                        "disability_intellectual_score=VALUES(disability_intellectual_score), " +
                        "disability_mental_or_psychosocial_score=VALUES(disability_mental_or_psychosocial_score), " +
                        "disability_chronic_score=VALUES(disability_chronic_score), " +
                        "disability_multiple_score=VALUES(disability_multiple_score), " +
                        "health_healthy_score=VALUES(health_healthy_score), " +
                        "health_temporarily_ill_score=VALUES(health_temporarily_ill_score), " +
                        "health_chronically_ill_score=VALUES(health_chronically_ill_score), " +
                        "health_immunocompromisedl_score=VALUES(health_immunocompromisedl_score), " +
                        "health_terminally_ill_score=VALUES(health_terminally_ill_score), " +
                        "health_with_medical_score=VALUES(health_with_medical_score), " +
                        "clean_water_access_yes_score=VALUES(clean_water_access_yes_score), " +
                        "clean_water_access_no_score=VALUES(clean_water_access_no_score), " +
                        "clean_water_access_irregular_score=VALUES(clean_water_access_irregular_score), " +
                        "sanitation_safely_score=VALUES(sanitation_safely_score), " +
                        "sanitation_shared_score=VALUES(sanitation_shared_score), " +
                        "sanitation_unimproved_score=VALUES(sanitation_unimproved_score), " +
                        "sanitation_no_score=VALUES(sanitation_no_score), " +
                        "house_construction_concrete_score=VALUES(house_construction_concrete_score), " +
                        "house_construction_light_materials_score=VALUES(house_construction_light_materials_score), " +
                        "house_construction_semi_concrete_score=VALUES(house_construction_semi_concrete_score), " +
                        "house_construction_makeshirt_score=VALUES(house_construction_makeshirt_score), " +
                        "ownership_owned_score=VALUES(ownership_owned_score), " +
                        "ownership_owned_without_score=VALUES(ownership_owned_without_score), " +
                        "ownership_rented_score=VALUES(ownership_rented_score), " +
                        "ownership_informal_score=VALUES(ownership_informal_score), " +
                        "ownership_evicted_score=VALUES(ownership_evicted_score), " +
                        "employment_regular_score=VALUES(employment_regular_score), " +
                        "employment_self_employed_stable_score=VALUES(employment_self_employed_stable_score), " +
                        "employment_self_employed_unstable_score=VALUES(employment_self_employed_unstable_score), " +
                        "employment_irregular_score=VALUES(employment_irregular_score), " +
                        "employment_unemployed_score=VALUES(employment_unemployed_score), " +
                        "income_poor_score=VALUES(income_poor_score), " +
                        "income_low_income_score=VALUES(income_low_income_score), " +
                        "income_middle_income_score=VALUES(income_middle_income_score), " +
                        "income_middle_class_score=VALUES(income_middle_class_score), " +
                        "income_upper_middle_class_score=VALUES(income_upper_middle_class_score), " +
                        "income_upper_income_score=VALUES(income_upper_income_score), " +
                        "income_rich_score=VALUES(income_rich_score), " +
                        "education_no_formal_education_score=VALUES(education_no_formal_education_score), " +
                        "education_elementary_score=VALUES(education_elementary_score), " +
                        "education_highschool_score=VALUES(education_highschool_score), " +
                        "education_vocational_score=VALUES(education_vocational_score), " +
                        "education_college_score=VALUES(education_college_score), " +
                        "education_graduated_score=VALUES(education_graduated_score), " +
                        "digital_reliable_score=VALUES(digital_reliable_score), " +
                        "digital_intermittent_score=VALUES(digital_intermittent_score), " +
                        "digital_limited_access_score=VALUES(digital_limited_access_score), " +
                        "digital_no_digital_score=VALUES(digital_no_digital_score), " +
                        "damage_no_visible_damage=VALUES(damage_no_visible_damage), " +
                        "damage_minor_damage=VALUES(damage_minor_damage), " +
                        "damage_moderate_damage=VALUES(damage_moderate_damage), " +
                        "damage_severe_damage=VALUES(damage_severe_damage), " +
                        "damage_destruction_or_collapse=VALUES(damage_destruction_or_collapse), " +
                        "reg_date=VALUES(reg_date)";



        try {
            conn = dbconnection.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql);

            int i = 1;

            ps.setInt(i++, vm.getVulnerabilityIndicatorId());
            ps.setDouble(i++, vm.getMaleScore());
            ps.setDouble(i++, vm.getFemaleScore());

            ps.setDouble(i++, vm.getSingleScore());
            ps.setDouble(i++, vm.getMarriedScore());
            ps.setDouble(i++, vm.getWidowedScore());
            ps.setDouble(i++, vm.getSeparatedScore());

            ps.setDouble(i++, vm.getSoloParentNotSoloParentScore());
            ps.setDouble(i++, vm.getSoloParentSpWithSnScore());
            ps.setDouble(i++, vm.getSoloParentSpWithoutSnScore());

            ps.setDouble(i++, vm.getDisabilityNoneScore());
            ps.setDouble(i++, vm.getDisabilityPhysicalScore());
            ps.setDouble(i++, vm.getDisabilityVisualScore());
            ps.setDouble(i++, vm.getDisabilityHearingScore());
            ps.setDouble(i++, vm.getDisabilitySpeechScore());
            ps.setDouble(i++, vm.getDisabilityIntellectualScore());
            ps.setDouble(i++, vm.getDisabilityMentalScore());
            ps.setDouble(i++, vm.getDisabilityChronicScore());
            ps.setDouble(i++, vm.getDisabilityMultipleScore());

            ps.setDouble(i++, vm.getHealthHealthyScore());
            ps.setDouble(i++, vm.getHealthTemporarilyIllScore());
            ps.setDouble(i++, vm.getHealthChronicallyIllScore());
            ps.setDouble(i++, vm.getHealthImmunocompromisedScore());
            ps.setDouble(i++, vm.getHealthTerminallyIllScore());
            ps.setDouble(i++, vm.getHealthWithMedicalScore());

            ps.setDouble(i++, vm.getCleanWaterYesScore());
            ps.setDouble(i++, vm.getCleanWaterNoScore());
            ps.setDouble(i++, vm.getCleanWaterIrregularScore());

            ps.setDouble(i++, vm.getSanitationSafelyScore());
            ps.setDouble(i++, vm.getSanitationSharedScore());
            ps.setDouble(i++, vm.getSanitationUnimprovedScore());
            ps.setDouble(i++, vm.getSanitationNoScore());

            ps.setDouble(i++, vm.getHouseConcreteScore());
            ps.setDouble(i++, vm.getHouseLightMaterialsScore());
            ps.setDouble(i++, vm.getHouseSemiConcreteScore());
            ps.setDouble(i++, vm.getHouseMakeshiftScore());

            ps.setDouble(i++, vm.getOwnershipOwnedScore());
            ps.setDouble(i++, vm.getOwnershipOwnedWithoutScore());
            ps.setDouble(i++, vm.getOwnershipRentedScore());
            ps.setDouble(i++, vm.getOwnershipInformalScore());
            ps.setDouble(i++, vm.getOwnershipEvictedScore());

            ps.setDouble(i++, vm.getEmploymentRegularScore());
            ps.setDouble(i++, vm.getEmploymentSelfEmployedStableScore());
            ps.setDouble(i++, vm.getEmploymentSelfEmployedUnstableScore());
            ps.setDouble(i++, vm.getEmploymentIrregularScore());
            ps.setDouble(i++, vm.getEmploymentUnemployedScore());

            ps.setDouble(i++, vm.getIncomePoorScore());
            ps.setDouble(i++, vm.getIncomeLowIncomeScore());
            ps.setDouble(i++, vm.getIncomeMiddleIncomeScore());
            ps.setDouble(i++, vm.getIncomeMiddleClassScore());
            ps.setDouble(i++, vm.getIncomeUpperMiddleClassScore());
            ps.setDouble(i++, vm.getIncomeUpperIncomeScore());
            ps.setDouble(i++, vm.getIncomeRichScore());

            ps.setDouble(i++, vm.getEducationNoFormalScore());
            ps.setDouble(i++, vm.getEducationElementaryScore());
            ps.setDouble(i++, vm.getEducationHighschoolScore());
            ps.setDouble(i++, vm.getEducationVocationalScore());
            ps.setDouble(i++, vm.getEducationCollegeScore());
            ps.setDouble(i++, vm.getEducationGraduatedScore());

            ps.setDouble(i++, vm.getDigitalReliableScore());
            ps.setDouble(i++, vm.getDigitalIntermittentScore());
            ps.setDouble(i++, vm.getDigitalLimitedAccessScore());
            ps.setDouble(i++, vm.getDigitalNoDigitalScore());

            ps.setDouble(i++, vm.getNoVisibleDamageScore());
            ps.setDouble(i++, vm.getMinorDamageScore());
            ps.setDouble(i++, vm.getModerateDamageScore());
            ps.setDouble(i++, vm.getSevereDamageScore());
            ps.setDouble(i++, vm.getDestructionOrCollapseScore());

            ps.setString(i++, vm.getRegDate());

            int rowsAffected = ps.executeUpdate();
            return rowsAffected > 0;

        } catch (SQLException e) {
            JOptionPane.showMessageDialog(null,
                    "Database error occurred: " + e.getMessage(),
                    "Error",
                    JOptionPane.ERROR_MESSAGE);
            e.printStackTrace();
            return false;

        } finally {
            try {
                if (conn != null) conn.close();
            } catch (SQLException e) {
                System.out.println("Error: " + e.getMessage());
            }
        }
    }

    @Override
    public VulnerabilityIndicatorScoreModel getVulnerabilityScoresByHouseholdId(int householdId) {
        String sql = "SELECT * FROM vulnerability_indicator_score WHERE vulnerability_indicator_id = ?";

        try {
            conn = dbconnection.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql);

            ps.setInt(1, householdId);

            try (ResultSet rs = ps.executeQuery()) {
                if (rs.next()) {
                    return new VulnerabilityIndicatorScoreModel(
                            rs.getInt("vulnerability_indicator_id"),

                            rs.getDouble("male_score"),
                            rs.getDouble("female_score"),

                            rs.getDouble("single_score"),
                            rs.getDouble("married_score"),
                            rs.getDouble("widowed_score"),
                            rs.getDouble("separated_score"),

                            rs.getDouble("solo_parent_status_not_solo_parent_score"),
                            rs.getDouble("solo_parent_status_sp_with_sn_score"),
                            rs.getDouble("solo_parent_status_sp_without_sn_score"),

                            rs.getDouble("disability_none_score"),
                            rs.getDouble("disability_physical_score"),
                            rs.getDouble("disability_visual_score"),
                            rs.getDouble("disability_hearing_score"),
                            rs.getDouble("disability_speech_score"),
                            rs.getDouble("disability_intellectual_score"),
                            rs.getDouble("disability_mental_or_psychosocial_score"),
                            rs.getDouble("disability_chronic_score"),
                            rs.getDouble("disability_multiple_score"),

                            rs.getDouble("health_healthy_score"),
                            rs.getDouble("health_temporarily_ill_score"),
                            rs.getDouble("health_chronically_ill_score"),
                            rs.getDouble("health_immunocompromisedl_score"),
                            rs.getDouble("health_terminally_ill_score"),
                            rs.getDouble("health_with_medical_score"),

                            rs.getDouble("clean_water_access_yes_score"),
                            rs.getDouble("clean_water_access_no_score"),
                            rs.getDouble("clean_water_access_irregular_score"),

                            rs.getDouble("sanitation_safely_score"),
                            rs.getDouble("sanitation_shared_score"),
                            rs.getDouble("sanitation_unimproved_score"),
                            rs.getDouble("sanitation_no_score"),

                            rs.getDouble("house_construction_concrete_score"),
                            rs.getDouble("house_construction_light_materials_score"),
                            rs.getDouble("house_construction_semi_concrete_score"),
                            rs.getDouble("house_construction_makeshirt_score"),

                            rs.getDouble("ownership_owned_score"),
                            rs.getDouble("ownership_owned_without_score"),
                            rs.getDouble("ownership_rented_score"),
                            rs.getDouble("ownership_informal_score"),
                            rs.getDouble("ownership_evicted_score"),

                            rs.getDouble("employment_regular_score"),
                            rs.getDouble("employment_self_employed_stable_score"),
                            rs.getDouble("employment_self_employed_unstable_score"),
                            rs.getDouble("employment_irregular_score"),
                            rs.getDouble("employment_unemployed_score"),

                            rs.getDouble("income_poor_score"),
                            rs.getDouble("income_low_income_score"),
                            rs.getDouble("income_middle_income_score"),
                            rs.getDouble("income_middle_class_score"),
                            rs.getDouble("income_upper_middle_class_score"),
                            rs.getDouble("income_upper_income_score"),
                            rs.getDouble("income_rich_score"),

                            rs.getDouble("education_no_formal_education_score"),
                            rs.getDouble("education_elementary_score"),
                            rs.getDouble("education_highschool_score"),
                            rs.getDouble("education_vocational_score"),
                            rs.getDouble("education_college_score"),
                            rs.getDouble("education_graduated_score"),

                            rs.getDouble("digital_reliable_score"),
                            rs.getDouble("digital_intermittent_score"),
                            rs.getDouble("digital_limited_access_score"),
                            rs.getDouble("digital_no_digital_score"),

                            rs.getDouble("damage_no_visible_damage"),
                            rs.getDouble("damage_minor_damage"),
                            rs.getDouble("damage_moderate_damage"),
                            rs.getDouble("damage_severe_damage"),
                            rs.getDouble("damage_destruction_or_collapse"),

                            rs.getString("reg_date")
                    );
                } else {
                    System.out.println("No vulnerability scores found for household ID: " + householdId);
                    return null;
                }
            }

        } catch (SQLException e) {
            System.err.println("Error fetching vulnerability scores for household ID " + householdId);
            e.printStackTrace();
            return null;
        } finally {
            try {
                if (conn != null) conn.close();
            } catch (SQLException e) {
                System.out.println("Error: " + e.getMessage());
            }
        }
    }

    @Override
    public VulnerabilityIndicatorScoreModel getScores() {
        String sql = "SELECT * FROM vulnerability_indicator_score LIMIT 1";

        try {
            conn = dbconnection.getConnection();
            PreparedStatement ps = conn.prepareStatement(sql);
            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                VulnerabilityIndicatorScoreModel scores = new VulnerabilityIndicatorScoreModel();

                // Gender scores
                scores.setMaleScore(rs.getDouble("male_score"));
                scores.setFemaleScore(rs.getDouble("female_score"));

                // Marital status scores
                scores.setSingleScore(rs.getDouble("single_score"));
                scores.setMarriedScore(rs.getDouble("married_score"));
                scores.setWidowedScore(rs.getDouble("widowed_score"));
                scores.setSeparatedScore(rs.getDouble("separated_score"));

                // Solo parent scores
                scores.setSoloParentNotSoloParentScore(rs.getDouble("solo_parent_status_not_solo_parent_score"));
                scores.setSoloParentSpWithSnScore(rs.getDouble("solo_parent_status_sp_with_sn_score"));
                scores.setSoloParentSpWithoutSnScore(rs.getDouble("solo_parent_status_sp_without_sn_score"));

                // Disability scores
                scores.setDisabilityNoneScore(rs.getDouble("disability_none_score"));
                scores.setDisabilityPhysicalScore(rs.getDouble("disability_physical_score"));
                scores.setDisabilityVisualScore(rs.getDouble("disability_visual_score"));
                scores.setDisabilityHearingScore(rs.getDouble("disability_hearing_score"));
                scores.setDisabilitySpeechScore(rs.getDouble("disability_speech_score"));
                scores.setDisabilityIntellectualScore(rs.getDouble("disability_intellectual_score"));
                scores.setDisabilityMentalScore(rs.getDouble("disability_mental_or_psychosocial_score"));
                scores.setDisabilityChronicScore(rs.getDouble("disability_chronic_score"));
                scores.setDisabilityMultipleScore(rs.getDouble("disability_multiple_score"));

                // Health condition scores
                scores.setHealthHealthyScore(rs.getDouble("health_healthy_score"));
                scores.setHealthTemporarilyIllScore(rs.getDouble("health_temporarily_ill_score"));
                scores.setHealthChronicallyIllScore(rs.getDouble("health_chronically_ill_score"));
                scores.setHealthImmunocompromisedScore(rs.getDouble("health_immunocompromisedl_score"));
                scores.setHealthTerminallyIllScore(rs.getDouble("health_terminally_ill_score"));
                scores.setHealthWithMedicalScore(rs.getDouble("health_with_medical_score"));

                // Clean water access scores
                scores.setCleanWaterYesScore(rs.getDouble("clean_water_access_yes_score"));
                scores.setCleanWaterNoScore(rs.getDouble("clean_water_access_no_score"));
                scores.setCleanWaterIrregularScore(rs.getDouble("clean_water_access_irregular_score"));

                // Sanitation facility scores
                scores.setSanitationSafelyScore(rs.getDouble("sanitation_safely_score"));
                scores.setSanitationSharedScore(rs.getDouble("sanitation_shared_score"));
                scores.setSanitationUnimprovedScore(rs.getDouble("sanitation_unimproved_score"));
                scores.setSanitationNoScore(rs.getDouble("sanitation_no_score"));

                // House construction scores
                scores.setHouseConcreteScore(rs.getDouble("house_construction_concrete_score"));
                scores.setHouseLightMaterialsScore(rs.getDouble("house_construction_light_materials_score"));
                scores.setHouseSemiConcreteScore(rs.getDouble("house_construction_semi_concrete_score"));
                scores.setHouseMakeshiftScore(rs.getDouble("house_construction_makeshirt_score"));

                // Ownership scores
                scores.setOwnershipOwnedScore(rs.getDouble("ownership_owned_score"));
                scores.setOwnershipOwnedWithoutScore(rs.getDouble("ownership_owned_without_score"));
                scores.setOwnershipRentedScore(rs.getDouble("ownership_rented_score"));
                scores.setOwnershipInformalScore(rs.getDouble("ownership_informal_score"));
                scores.setOwnershipEvictedScore(rs.getDouble("ownership_evicted_score"));

                // Employment scores
                scores.setEmploymentRegularScore(rs.getDouble("employment_regular_score"));
                scores.setEmploymentSelfEmployedStableScore(rs.getDouble("employment_self_employed_stable_score"));
                scores.setEmploymentSelfEmployedUnstableScore(rs.getDouble("employment_self_employed_unstable_score"));
                scores.setEmploymentIrregularScore(rs.getDouble("employment_irregular_score"));
                scores.setEmploymentUnemployedScore(rs.getDouble("employment_unemployed_score"));

                // Income scores
                scores.setIncomePoorScore(rs.getDouble("income_poor_score"));
                scores.setIncomeLowIncomeScore(rs.getDouble("income_low_income_score"));
                scores.setIncomeMiddleIncomeScore(rs.getDouble("income_middle_income_score"));
                scores.setIncomeMiddleClassScore(rs.getDouble("income_middle_class_score"));
                scores.setIncomeUpperMiddleClassScore(rs.getDouble("income_upper_middle_class_score"));
                scores.setIncomeUpperIncomeScore(rs.getDouble("income_upper_income_score"));
                scores.setIncomeRichScore(rs.getDouble("income_rich_score"));

                // Education scores
                scores.setEducationNoFormalScore(rs.getDouble("education_no_formal_education_score"));
                scores.setEducationElementaryScore(rs.getDouble("education_elementary_score"));
                scores.setEducationHighschoolScore(rs.getDouble("education_highschool_score"));
                scores.setEducationVocationalScore(rs.getDouble("education_vocational_score"));
                scores.setEducationCollegeScore(rs.getDouble("education_college_score"));
                scores.setEducationGraduatedScore(rs.getDouble("education_graduated_score"));

                // Digital access scores
                scores.setDigitalReliableScore(rs.getDouble("digital_reliable_score"));
                scores.setDigitalIntermittentScore(rs.getDouble("digital_intermittent_score"));
                scores.setDigitalLimitedAccessScore(rs.getDouble("digital_limited_access_score"));
                scores.setDigitalNoDigitalScore(rs.getDouble("digital_no_digital_score"));

                // Damage scores
                scores.setNoVisibleDamageScore(rs.getDouble("damage_no_visible_damage"));
                scores.setMinorDamageScore(rs.getDouble("damage_minor_damage"));
                scores.setModerateDamageScore(rs.getDouble("damage_moderate_damage"));
                scores.setSevereDamageScore(rs.getDouble("damage_severe_damage"));
                scores.setDestructionOrCollapseScore(rs.getDouble("damage_destruction_or_collapse"));

                return scores;
            }

        } catch (SQLException e) {
            System.err.println("Error fetching vulnerability scores: " + e.getMessage());
            e.printStackTrace();
        } finally {
            try {
                if (conn != null) conn.close();
            } catch (SQLException e) {
                System.out.println("Error: " + e.getMessage());
            }
        }

        return null;
    }
}