package com.ionres.respondph.vulnerability_indicator;

import com.ionres.respondph.database.DBConnection;
import com.ionres.respondph.exception.ExceptionFactory;
import java.sql.SQLException;
import java.util.logging.Level;
import java.util.logging.Logger;

public class VulnerabilityIndicatorServiceImpl implements VulnerabilityIndicatorService {
    private static final Logger LOGGER = Logger.getLogger(VulnerabilityIndicatorServiceImpl.class.getName());
    private final VulnerabilityIndicatorDAOService vulnerabilityIndicatorDAOService;

    public VulnerabilityIndicatorServiceImpl(DBConnection dbConnection) {
        this.vulnerabilityIndicatorDAOService = new VulnerabilityIndicatorDAOServiceImpl(dbConnection);
    }

    @Override
    public boolean createVulnerabilityIndicatorScore(VulnerabilityIndicatorScoreModel vism) {

        try {

            boolean flag = vulnerabilityIndicatorDAOService.saveVulnerabilityScores(
                    vism
            );

            if (!flag) {
                throw ExceptionFactory.failedToCreate("Vulnerability Indicator Score");
            }

            return flag;

        } catch (Exception ex) {
            LOGGER.log(Level.SEVERE, "Error creating vulnerability indicator score", ex);
            return false;
        }
    }

    @Override
    public VulnerabilityIndicatorScoreModel getData(int householdId) {
        try {
            VulnerabilityIndicatorScoreModel vism = vulnerabilityIndicatorDAOService.getVulnerabilityScoresByHouseholdId(householdId);

            if (vism == null) {
                LOGGER.warning("No data found for household ID: " + householdId);
            }

            return vism;

        } catch (Exception ex) {
            LOGGER.log(Level.SEVERE, "Error fetching data for household ID: " + householdId, ex);
            return null;
        }
    }
}
